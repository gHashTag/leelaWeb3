b4b8d40b61d6fb01357ff80580234a8c
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.cleanupTokens = cleanupTokens;
var _getTokenTypeByToken = _interopRequireDefault(require("./getTokenTypeByToken"));
var _flattenInlineTokens = _interopRequireDefault(require("./flattenInlineTokens"));
var _renderInlineAsText = _interopRequireDefault(require("./renderInlineAsText"));
function cleanupTokens(tokens) {
  tokens = (0, _flattenInlineTokens.default)(tokens);
  tokens.forEach(function (token) {
    token.type = (0, _getTokenTypeByToken.default)(token);
    if (token.type === 'image' || token.type === 'hardbreak') {
      token.block = true;
    }
    if (token.type === 'image') {
      token.attrs[token.attrIndex('alt')][1] = (0, _renderInlineAsText.default)(token.children);
    }
  });
  var stack = [];
  tokens = tokens.reduce(function (acc, token, index) {
    if (token.type === 'link' && token.nesting === 1) {
      stack.push(token);
    } else if (stack.length > 0 && token.type === 'link' && token.nesting === -1) {
      if (stack.some(function (stackToken) {
        return stackToken.block;
      })) {
        stack[0].type = 'blocklink';
        stack[0].block = true;
        token.type = 'blocklink';
        token.block = true;
      }
      stack.push(token);
      while (stack.length) {
        acc.push(stack.shift());
      }
    } else if (stack.length > 0) {
      stack.push(token);
    } else {
      acc.push(token);
    }
    return acc;
  }, []);
  return tokens;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0VG9rZW5UeXBlQnlUb2tlbiIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2ZsYXR0ZW5JbmxpbmVUb2tlbnMiLCJfcmVuZGVySW5saW5lQXNUZXh0IiwiY2xlYW51cFRva2VucyIsInRva2VucyIsImZsYXR0ZW5JbmxpbmVUb2tlbnMiLCJmb3JFYWNoIiwidG9rZW4iLCJ0eXBlIiwiZ2V0VG9rZW5UeXBlQnlUb2tlbiIsImJsb2NrIiwiYXR0cnMiLCJhdHRySW5kZXgiLCJyZW5kZXJJbmxpbmVBc1RleHQiLCJjaGlsZHJlbiIsInN0YWNrIiwicmVkdWNlIiwiYWNjIiwiaW5kZXgiLCJuZXN0aW5nIiwicHVzaCIsImxlbmd0aCIsInNvbWUiLCJzdGFja1Rva2VuIiwic2hpZnQiXSwic291cmNlcyI6WyJjbGVhbnVwVG9rZW5zLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBnZXRUb2tlblR5cGVCeVRva2VuIGZyb20gJy4vZ2V0VG9rZW5UeXBlQnlUb2tlbic7XG5pbXBvcnQgZmxhdHRlbklubGluZVRva2VucyBmcm9tICcuL2ZsYXR0ZW5JbmxpbmVUb2tlbnMnO1xuaW1wb3J0IHJlbmRlcklubGluZUFzVGV4dCBmcm9tICcuL3JlbmRlcklubGluZUFzVGV4dCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBjbGVhbnVwVG9rZW5zKHRva2Vucykge1xuICB0b2tlbnMgPSBmbGF0dGVuSW5saW5lVG9rZW5zKHRva2Vucyk7XG4gIHRva2Vucy5mb3JFYWNoKCh0b2tlbikgPT4ge1xuICAgIHRva2VuLnR5cGUgPSBnZXRUb2tlblR5cGVCeVRva2VuKHRva2VuKTtcblxuICAgIC8vIHNldCBpbWFnZSBhbmQgaGFyZGJyZWFrIHRvIGJsb2NrIGVsZW1lbnRzXG4gICAgaWYgKHRva2VuLnR5cGUgPT09ICdpbWFnZScgfHwgdG9rZW4udHlwZSA9PT0gJ2hhcmRicmVhaycpIHtcbiAgICAgIHRva2VuLmJsb2NrID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBTZXQgaW1nIGFsdCB0ZXh0XG4gICAgaWYgKHRva2VuLnR5cGUgPT09ICdpbWFnZScpIHtcbiAgICAgIHRva2VuLmF0dHJzW3Rva2VuLmF0dHJJbmRleCgnYWx0JyldWzFdID0gcmVuZGVySW5saW5lQXNUZXh0KFxuICAgICAgICB0b2tlbi5jaGlsZHJlbixcbiAgICAgICk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogY2hhbmdpbmcgYSBsaW5rIHRva2VuIHRvIGEgYmxvY2tsaW5rIHRvIGZpeCBpc3N1ZSB3aGVyZSBsaW5rIHRva2VucyB3aXRoXG4gICAqIG5lc3RlZCBub24gdGV4dCB0b2tlbnMgYnJlYWtzIGNvbXBvbmVudFxuICAgKi9cbiAgY29uc3Qgc3RhY2sgPSBbXTtcbiAgdG9rZW5zID0gdG9rZW5zLnJlZHVjZSgoYWNjLCB0b2tlbiwgaW5kZXgpID0+IHtcbiAgICBpZiAodG9rZW4udHlwZSA9PT0gJ2xpbmsnICYmIHRva2VuLm5lc3RpbmcgPT09IDEpIHtcbiAgICAgIHN0YWNrLnB1c2godG9rZW4pO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBzdGFjay5sZW5ndGggPiAwICYmXG4gICAgICB0b2tlbi50eXBlID09PSAnbGluaycgJiZcbiAgICAgIHRva2VuLm5lc3RpbmcgPT09IC0xXG4gICAgKSB7XG4gICAgICBpZiAoc3RhY2suc29tZSgoc3RhY2tUb2tlbikgPT4gc3RhY2tUb2tlbi5ibG9jaykpIHtcbiAgICAgICAgc3RhY2tbMF0udHlwZSA9ICdibG9ja2xpbmsnO1xuICAgICAgICBzdGFja1swXS5ibG9jayA9IHRydWU7XG4gICAgICAgIHRva2VuLnR5cGUgPSAnYmxvY2tsaW5rJztcbiAgICAgICAgdG9rZW4uYmxvY2sgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBzdGFjay5wdXNoKHRva2VuKTtcblxuICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCkge1xuICAgICAgICBhY2MucHVzaChzdGFjay5zaGlmdCgpKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHN0YWNrLmxlbmd0aCA+IDApIHtcbiAgICAgIHN0YWNrLnB1c2godG9rZW4pO1xuICAgIH0gZWxzZSB7XG4gICAgICBhY2MucHVzaCh0b2tlbik7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjYztcbiAgfSwgW10pO1xuXG4gIHJldHVybiB0b2tlbnM7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsSUFBQUEsb0JBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLG9CQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRSxtQkFBQSxHQUFBSCxzQkFBQSxDQUFBQyxPQUFBO0FBRU8sU0FBU0csYUFBYUEsQ0FBQ0MsTUFBTSxFQUFFO0VBQ3BDQSxNQUFNLEdBQUcsSUFBQUMsNEJBQW1CLEVBQUNELE1BQU0sQ0FBQztFQUNwQ0EsTUFBTSxDQUFDRSxPQUFPLENBQUMsVUFBQ0MsS0FBSyxFQUFLO0lBQ3hCQSxLQUFLLENBQUNDLElBQUksR0FBRyxJQUFBQyw0QkFBbUIsRUFBQ0YsS0FBSyxDQUFDO0lBR3ZDLElBQUlBLEtBQUssQ0FBQ0MsSUFBSSxLQUFLLE9BQU8sSUFBSUQsS0FBSyxDQUFDQyxJQUFJLEtBQUssV0FBVyxFQUFFO01BQ3hERCxLQUFLLENBQUNHLEtBQUssR0FBRyxJQUFJO0lBQ3BCO0lBR0EsSUFBSUgsS0FBSyxDQUFDQyxJQUFJLEtBQUssT0FBTyxFQUFFO01BQzFCRCxLQUFLLENBQUNJLEtBQUssQ0FBQ0osS0FBSyxDQUFDSyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFBQywyQkFBa0IsRUFDekROLEtBQUssQ0FBQ08sUUFDUixDQUFDO0lBQ0g7RUFDRixDQUFDLENBQUM7RUFNRixJQUFNQyxLQUFLLEdBQUcsRUFBRTtFQUNoQlgsTUFBTSxHQUFHQSxNQUFNLENBQUNZLE1BQU0sQ0FBQyxVQUFDQyxHQUFHLEVBQUVWLEtBQUssRUFBRVcsS0FBSyxFQUFLO0lBQzVDLElBQUlYLEtBQUssQ0FBQ0MsSUFBSSxLQUFLLE1BQU0sSUFBSUQsS0FBSyxDQUFDWSxPQUFPLEtBQUssQ0FBQyxFQUFFO01BQ2hESixLQUFLLENBQUNLLElBQUksQ0FBQ2IsS0FBSyxDQUFDO0lBQ25CLENBQUMsTUFBTSxJQUNMUSxLQUFLLENBQUNNLE1BQU0sR0FBRyxDQUFDLElBQ2hCZCxLQUFLLENBQUNDLElBQUksS0FBSyxNQUFNLElBQ3JCRCxLQUFLLENBQUNZLE9BQU8sS0FBSyxDQUFDLENBQUMsRUFDcEI7TUFDQSxJQUFJSixLQUFLLENBQUNPLElBQUksQ0FBQyxVQUFDQyxVQUFVO1FBQUEsT0FBS0EsVUFBVSxDQUFDYixLQUFLO01BQUEsRUFBQyxFQUFFO1FBQ2hESyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUNQLElBQUksR0FBRyxXQUFXO1FBQzNCTyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUNMLEtBQUssR0FBRyxJQUFJO1FBQ3JCSCxLQUFLLENBQUNDLElBQUksR0FBRyxXQUFXO1FBQ3hCRCxLQUFLLENBQUNHLEtBQUssR0FBRyxJQUFJO01BQ3BCO01BRUFLLEtBQUssQ0FBQ0ssSUFBSSxDQUFDYixLQUFLLENBQUM7TUFFakIsT0FBT1EsS0FBSyxDQUFDTSxNQUFNLEVBQUU7UUFDbkJKLEdBQUcsQ0FBQ0csSUFBSSxDQUFDTCxLQUFLLENBQUNTLEtBQUssQ0FBQyxDQUFDLENBQUM7TUFDekI7SUFDRixDQUFDLE1BQU0sSUFBSVQsS0FBSyxDQUFDTSxNQUFNLEdBQUcsQ0FBQyxFQUFFO01BQzNCTixLQUFLLENBQUNLLElBQUksQ0FBQ2IsS0FBSyxDQUFDO0lBQ25CLENBQUMsTUFBTTtNQUNMVSxHQUFHLENBQUNHLElBQUksQ0FBQ2IsS0FBSyxDQUFDO0lBQ2pCO0lBRUEsT0FBT1UsR0FBRztFQUNaLENBQUMsRUFBRSxFQUFFLENBQUM7RUFFTixPQUFPYixNQUFNO0FBQ2YifQ==