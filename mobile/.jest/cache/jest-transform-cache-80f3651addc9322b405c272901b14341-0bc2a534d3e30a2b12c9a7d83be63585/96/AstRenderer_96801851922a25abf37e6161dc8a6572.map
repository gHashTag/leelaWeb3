{"version":3,"names":["_reactNative","require","_getUniqueID","_interopRequireDefault","_convertAdditionalStyles","_textStyleProps","AstRenderer","_createClass2","default","renderRules","style","onLinkPress","maxTopLevelChildren","topLevelMaxExceededItem","allowedImageHandlers","defaultImageHandler","debugPrintTree","_this","_classCallCheck2","getRenderFunction","type","renderFunction","_renderRules","console","warn","unknown","renderNode","node","parentNodes","isRoot","arguments","length","undefined","parents","_toConsumableArray2","_debugPrintTree","str","a","log","unshift","children","map","value","_style","_onLinkPress","_allowedImageHandlers","_defaultImageHandler","styleObj","refStyle","attributes","convertAdditionalStyles","Object","assign","StyleSheet","flatten","contentStyle","bullet_list_content","ordered_list_content","arr","keys","b","textStyleProps","includes","_maxTopLevelChildren","slice","push","_topLevelMaxExceededItem","render","nodes","root","key","getUniqueID","exports"],"sources":["AstRenderer.js"],"sourcesContent":["import {StyleSheet} from 'react-native';\n\nimport getUniqueID from './util/getUniqueID';\nimport convertAdditionalStyles from './util/convertAdditionalStyles';\n\nimport textStyleProps from './data/textStyleProps';\n\nexport default class AstRenderer {\n  /**\n   *\n   * @param {Object.<string, function>} renderRules\n   * @param {any} style\n   */\n  constructor(\n    renderRules,\n    style,\n    onLinkPress,\n    maxTopLevelChildren,\n    topLevelMaxExceededItem,\n    allowedImageHandlers,\n    defaultImageHandler,\n    debugPrintTree,\n  ) {\n    this._renderRules = renderRules;\n    this._style = style;\n    this._onLinkPress = onLinkPress;\n    this._maxTopLevelChildren = maxTopLevelChildren;\n    this._topLevelMaxExceededItem = topLevelMaxExceededItem;\n    this._allowedImageHandlers = allowedImageHandlers;\n    this._defaultImageHandler = defaultImageHandler;\n    this._debugPrintTree = debugPrintTree;\n  }\n\n  /**\n   *\n   * @param {string} type\n   * @return {string}\n   */\n  getRenderFunction = (type) => {\n    const renderFunction = this._renderRules[type];\n\n    if (!renderFunction) {\n      console.warn(\n        `Warning, unknown render rule encountered: ${type}. 'unknown' render rule used (by default, returns null - nothing rendered)`,\n      );\n      return this._renderRules.unknown;\n    }\n\n    return renderFunction;\n  };\n\n  /**\n   *\n   * @param node\n   * @param parentNodes\n   * @return {*}\n   */\n  renderNode = (node, parentNodes, isRoot = false) => {\n    const renderFunction = this.getRenderFunction(node.type);\n    const parents = [...parentNodes];\n\n    if (this._debugPrintTree === true) {\n      let str = '';\n\n      for (let a = 0; a < parents.length; a++) {\n        str = str + '-';\n      }\n\n      console.log(`${str}${node.type}`);\n    }\n\n    parents.unshift(node);\n\n    // calculate the children first\n    let children = node.children.map((value) => {\n      return this.renderNode(value, parents);\n    });\n\n    // render any special types of nodes that have different renderRule function signatures\n\n    if (node.type === 'link' || node.type === 'blocklink') {\n      return renderFunction(\n        node,\n        children,\n        parentNodes,\n        this._style,\n        this._onLinkPress,\n      );\n    }\n\n    if (node.type === 'image') {\n      return renderFunction(\n        node,\n        children,\n        parentNodes,\n        this._style,\n        this._allowedImageHandlers,\n        this._defaultImageHandler,\n      );\n    }\n\n    // We are at the bottom of some tree - grab all the parent styles\n    // this effectively grabs the styles from parents and\n    // applies them in order of priority parent (least) to child (most)\n    // to allow styling global, then lower down things individually\n\n    // we have to handle list_item seperately here because they have some child\n    // pseudo classes that need the additional style props from parents passed down to them\n    if (children.length === 0 || node.type === 'list_item') {\n      const styleObj = {};\n\n      for (let a = parentNodes.length - 1; a > -1; a--) {\n        // grab and additional attributes specified by markdown-it\n        let refStyle = {};\n\n        if (\n          parentNodes[a].attributes &&\n          parentNodes[a].attributes.style &&\n          typeof parentNodes[a].attributes.style === 'string'\n        ) {\n          refStyle = convertAdditionalStyles(parentNodes[a].attributes.style);\n        }\n\n        // combine in specific styles for the object\n        if (this._style[parentNodes[a].type]) {\n          refStyle = {\n            ...refStyle,\n            ...StyleSheet.flatten(this._style[parentNodes[a].type]),\n          };\n\n          // workaround for list_items and their content cascading down the tree\n          if (parentNodes[a].type === 'list_item') {\n            let contentStyle = {};\n\n            if (parentNodes[a + 1].type === 'bullet_list') {\n              contentStyle = this._style.bullet_list_content;\n            } else if (parentNodes[a + 1].type === 'ordered_list') {\n              contentStyle = this._style.ordered_list_content;\n            }\n\n            refStyle = {\n              ...refStyle,\n              ...StyleSheet.flatten(contentStyle),\n            };\n          }\n        }\n\n        // then work out if any of them are text styles that should be used in the end.\n        const arr = Object.keys(refStyle);\n\n        for (let b = 0; b < arr.length; b++) {\n          if (textStyleProps.includes(arr[b])) {\n            styleObj[arr[b]] = refStyle[arr[b]];\n          }\n        }\n      }\n\n      return renderFunction(node, children, parentNodes, this._style, styleObj);\n    }\n\n    // cull top level children\n\n    if (\n      isRoot === true &&\n      this._maxTopLevelChildren &&\n      children.length > this._maxTopLevelChildren\n    ) {\n      children = children.slice(0, this._maxTopLevelChildren);\n      children.push(this._topLevelMaxExceededItem);\n    }\n\n    // render anythign else that has a normal signature\n\n    return renderFunction(node, children, parentNodes, this._style);\n  };\n\n  /**\n   *\n   * @param nodes\n   * @return {*}\n   */\n  render = (nodes) => {\n    const root = {type: 'body', key: getUniqueID(), children: nodes};\n    return this.renderNode(root, [], true);\n  };\n}\n"],"mappings":"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"}