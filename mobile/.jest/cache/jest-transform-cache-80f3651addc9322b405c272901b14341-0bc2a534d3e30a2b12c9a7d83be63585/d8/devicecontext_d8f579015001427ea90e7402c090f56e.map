{"version":3,"names":["_utils","require","_reactNative","_breadcrumb","_wrapper","DeviceContext","_classCallCheck2","default","name","id","_createClass2","key","value","setupOnce","addGlobalEventProcessor","getCurrentHub","_this","event","__awaiter","self","getIntegration","native","NATIVE","fetchNativeDeviceContexts","e","logger","log","nativeUser","user","nativeContexts","contexts","AppState","currentState","app","Object","assign","in_foreground","nativeTags","tags","nativeExtra","extra","nativeFingerprint","fingerprint","_a","concat","filter","item","indexOf","nativeLevel","severityLevelFromString","undefined","level","nativeEnvironment","environment","nativeBreadcrumbs","Array","isArray","map","breadcrumbFromObject","breadcrumbs","exports"],"sources":["../../../src/js/integrations/devicecontext.ts"],"sourcesContent":["/* eslint-disable complexity */\nimport type { Event, EventProcessor, Hub, Integration } from '@sentry/types';\nimport { logger, severityLevelFromString } from '@sentry/utils';\nimport { AppState } from 'react-native';\n\nimport { breadcrumbFromObject } from '../breadcrumb';\nimport type { NativeDeviceContextsResponse } from '../NativeRNSentry';\nimport { NATIVE } from '../wrapper';\n\n/** Load device context from native. */\nexport class DeviceContext implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'DeviceContext';\n\n  /**\n   * @inheritDoc\n   */\n  public name: string = DeviceContext.id;\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(addGlobalEventProcessor: (callback: EventProcessor) => void, getCurrentHub: () => Hub): void {\n    addGlobalEventProcessor(async (event: Event) => {\n      const self = getCurrentHub().getIntegration(DeviceContext);\n      if (!self) {\n        return event;\n      }\n\n      let native: NativeDeviceContextsResponse | null = null;\n      try {\n        native = await NATIVE.fetchNativeDeviceContexts();\n      } catch (e) {\n        logger.log(`Failed to get device context from native: ${e}`);\n      }\n\n      if (!native) {\n        return event;\n      }\n\n      const nativeUser = native.user;\n      if (!event.user && nativeUser) {\n        event.user = nativeUser;\n      }\n\n      let nativeContexts = native.contexts;\n      if (AppState.currentState !== 'unknown') {\n        nativeContexts = nativeContexts || {};\n        nativeContexts.app = {\n          ...nativeContexts.app,\n          in_foreground: AppState.currentState === 'active',\n        };\n      }\n      if (nativeContexts) {\n        event.contexts = { ...nativeContexts, ...event.contexts };\n      }\n\n      const nativeTags = native.tags;\n      if (nativeTags) {\n        event.tags = { ...nativeTags, ...event.tags };\n      }\n\n      const nativeExtra = native.extra;\n      if (nativeExtra) {\n        event.extra = { ...nativeExtra, ...event.extra };\n      }\n\n      const nativeFingerprint = native.fingerprint;\n      if (nativeFingerprint) {\n        event.fingerprint = (event.fingerprint ?? []).concat(\n          nativeFingerprint.filter(item => (event.fingerprint ?? []).indexOf(item) < 0),\n        );\n      }\n\n      const nativeLevel = typeof native['level'] === 'string' ? severityLevelFromString(native['level']) : undefined;\n      if (!event.level && nativeLevel) {\n        event.level = nativeLevel;\n      }\n\n      const nativeEnvironment = native['environment'];\n      if (!event.environment && nativeEnvironment) {\n        event.environment = nativeEnvironment;\n      }\n\n      const nativeBreadcrumbs = Array.isArray(native['breadcrumbs'])\n        ? native['breadcrumbs'].map(breadcrumbFromObject)\n        : undefined;\n      if (nativeBreadcrumbs) {\n        event.breadcrumbs = nativeBreadcrumbs;\n      }\n\n      return event;\n    });\n  }\n}\n"],"mappings":"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"}