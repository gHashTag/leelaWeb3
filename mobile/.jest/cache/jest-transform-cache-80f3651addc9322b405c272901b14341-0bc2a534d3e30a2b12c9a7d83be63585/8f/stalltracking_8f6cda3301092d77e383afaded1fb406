2968f85b3441d3e0e1bc6947f71ff688
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.StallTrackingInstrumentation = void 0;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _utils = require("@sentry/utils");
var _measurements = require("../measurements");
var MARGIN_OF_ERROR_SECONDS = 0.02;
var LOOP_TIMEOUT_INTERVAL_MS = 50;
var MAX_RUNNING_TRANSACTIONS = 10;
var StallTrackingInstrumentation = function () {
  function StallTrackingInstrumentation() {
    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {
      minimumStallThreshold: 50
    };
    (0, _classCallCheck2.default)(this, StallTrackingInstrumentation);
    this.isTracking = false;
    this._totalStallTime = 0;
    this._stallCount = 0;
    this._lastIntervalMs = 0;
    this._timeout = null;
    this._statsByTransaction = new Map();
    this._minimumStallThreshold = options.minimumStallThreshold;
  }
  (0, _createClass2.default)(StallTrackingInstrumentation, [{
    key: "setupOnce",
    value: function setupOnce() {}
  }, {
    key: "onTransactionStart",
    value: function onTransactionStart(transaction) {
      var _this = this;
      if (this._statsByTransaction.has(transaction)) {
        _utils.logger.error('[StallTracking] Tried to start stall tracking on a transaction already being tracked. Measurements might be lost.');
        return;
      }
      this._startTracking();
      this._statsByTransaction.set(transaction, {
        longestStallTime: 0,
        atTimestamp: null,
        atStart: this._getCurrentStats(transaction)
      });
      this._flushLeakedTransactions();
      if (transaction.spanRecorder) {
        var originalAdd = transaction.spanRecorder.add;
        transaction.spanRecorder.add = function (span) {
          originalAdd.apply(transaction.spanRecorder, [span]);
          var originalSpanFinish = span.finish;
          span.finish = function (endTimestamp) {
            originalSpanFinish.apply(span, [endTimestamp]);
            if (span.endTimestamp) {
              _this._markSpanFinish(transaction, span.endTimestamp);
            }
          };
        };
      }
    }
  }, {
    key: "onTransactionFinish",
    value: function onTransactionFinish(transaction, passedEndTimestamp) {
      var transactionStats = this._statsByTransaction.get(transaction);
      if (!transactionStats) {
        _utils.logger.log('[StallTracking] Stall measurements were not added to transaction due to exceeding the max count.');
        this._statsByTransaction.delete(transaction);
        this._shouldStopTracking();
        return;
      }
      var endTimestamp = passedEndTimestamp !== null && passedEndTimestamp !== void 0 ? passedEndTimestamp : transaction.endTimestamp;
      var spans = transaction.spanRecorder ? transaction.spanRecorder.spans : [];
      var finishedSpanCount = spans.reduce(function (count, s) {
        return s !== transaction && s.endTimestamp ? count + 1 : count;
      }, 0);
      var trimEnd = transaction.toContext().trimEnd;
      var endWillBeTrimmed = trimEnd && finishedSpanCount > 0;
      var isIdleTransaction = ('activities' in transaction);
      var statsOnFinish;
      if (endTimestamp && isIdleTransaction) {
        var spansWillBeCancelled = spans.some(function (s) {
          return s !== transaction && s.startTimestamp < endTimestamp && !s.endTimestamp;
        });
        if (endWillBeTrimmed && !spansWillBeCancelled) {
          if (transactionStats.atTimestamp) {
            statsOnFinish = transactionStats.atTimestamp.stats;
          }
        } else {
          statsOnFinish = this._getCurrentStats(transaction);
        }
      } else if (endWillBeTrimmed) {
        if (transactionStats.atTimestamp) {
          statsOnFinish = transactionStats.atTimestamp.stats;
        }
      } else if (!endTimestamp) {
        statsOnFinish = this._getCurrentStats(transaction);
      }
      this._statsByTransaction.delete(transaction);
      this._shouldStopTracking();
      if (!statsOnFinish) {
        if (typeof endTimestamp !== 'undefined') {
          _utils.logger.log('[StallTracking] Stall measurements not added due to `endTimestamp` being set.');
        } else if (trimEnd) {
          _utils.logger.log('[StallTracking] Stall measurements not added due to `trimEnd` being set but we could not determine the stall measurements at that time.');
        }
        return;
      }
      transaction.setMeasurement(_measurements.STALL_COUNT, statsOnFinish.stall_count.value - transactionStats.atStart.stall_count.value, transactionStats.atStart.stall_count.unit);
      transaction.setMeasurement(_measurements.STALL_TOTAL_TIME, statsOnFinish.stall_total_time.value - transactionStats.atStart.stall_total_time.value, transactionStats.atStart.stall_total_time.unit);
      transaction.setMeasurement(_measurements.STALL_LONGEST_TIME, statsOnFinish.stall_longest_time.value, statsOnFinish.stall_longest_time.unit);
    }
  }, {
    key: "_markSpanFinish",
    value: function _markSpanFinish(transaction, spanEndTimestamp) {
      var previousStats = this._statsByTransaction.get(transaction);
      if (previousStats) {
        if (Math.abs((0, _utils.timestampInSeconds)() - spanEndTimestamp) > MARGIN_OF_ERROR_SECONDS) {
          _utils.logger.log('[StallTracking] Span end not logged due to end timestamp being outside the margin of error from now.');
          if (previousStats.atTimestamp && previousStats.atTimestamp.timestamp < spanEndTimestamp) {
            this._statsByTransaction.set(transaction, Object.assign(Object.assign({}, previousStats), {
              atTimestamp: null
            }));
          }
        } else {
          this._statsByTransaction.set(transaction, Object.assign(Object.assign({}, previousStats), {
            atTimestamp: {
              timestamp: spanEndTimestamp,
              stats: this._getCurrentStats(transaction)
            }
          }));
        }
      }
    }
  }, {
    key: "_getCurrentStats",
    value: function _getCurrentStats(transaction) {
      var _a, _b;
      return {
        stall_count: {
          value: this._stallCount,
          unit: 'none'
        },
        stall_total_time: {
          value: this._totalStallTime,
          unit: 'millisecond'
        },
        stall_longest_time: {
          value: (_b = (_a = this._statsByTransaction.get(transaction)) === null || _a === void 0 ? void 0 : _a.longestStallTime) !== null && _b !== void 0 ? _b : 0,
          unit: 'millisecond'
        }
      };
    }
  }, {
    key: "_startTracking",
    value: function _startTracking() {
      if (!this.isTracking) {
        this.isTracking = true;
        this._lastIntervalMs = Math.floor((0, _utils.timestampInSeconds)() * 1000);
        this._iteration();
      }
    }
  }, {
    key: "_stopTracking",
    value: function _stopTracking() {
      this.isTracking = false;
      if (this._timeout !== null) {
        clearTimeout(this._timeout);
        this._timeout = null;
      }
      this._reset();
    }
  }, {
    key: "_shouldStopTracking",
    value: function _shouldStopTracking() {
      if (this._statsByTransaction.size === 0) {
        this._stopTracking();
      }
    }
  }, {
    key: "_reset",
    value: function _reset() {
      this._stallCount = 0;
      this._totalStallTime = 0;
      this._lastIntervalMs = 0;
      this._statsByTransaction.clear();
    }
  }, {
    key: "_iteration",
    value: function _iteration() {
      var _a;
      var now = (0, _utils.timestampInSeconds)() * 1000;
      var totalTimeTaken = now - this._lastIntervalMs;
      if (totalTimeTaken >= LOOP_TIMEOUT_INTERVAL_MS + this._minimumStallThreshold) {
        var stallTime = totalTimeTaken - LOOP_TIMEOUT_INTERVAL_MS;
        this._stallCount += 1;
        this._totalStallTime += stallTime;
        for (var _ref of this._statsByTransaction.entries()) {
          var _ref2 = (0, _slicedToArray2.default)(_ref, 2);
          var transaction = _ref2[0];
          var value = _ref2[1];
          var longestStallTime = Math.max((_a = value.longestStallTime) !== null && _a !== void 0 ? _a : 0, stallTime);
          this._statsByTransaction.set(transaction, Object.assign(Object.assign({}, value), {
            longestStallTime: longestStallTime
          }));
        }
      }
      this._lastIntervalMs = now;
      if (this.isTracking) {
        this._timeout = setTimeout(this._iteration.bind(this), LOOP_TIMEOUT_INTERVAL_MS);
      }
    }
  }, {
    key: "_flushLeakedTransactions",
    value: function _flushLeakedTransactions() {
      if (this._statsByTransaction.size > MAX_RUNNING_TRANSACTIONS) {
        var counter = 0;
        var len = this._statsByTransaction.size - MAX_RUNNING_TRANSACTIONS;
        var transactions = this._statsByTransaction.keys();
        for (var t of transactions) {
          if (counter >= len) break;
          counter += 1;
          this._statsByTransaction.delete(t);
        }
      }
    }
  }]);
  return StallTrackingInstrumentation;
}();
exports.StallTrackingInstrumentation = StallTrackingInstrumentation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdXRpbHMiLCJyZXF1aXJlIiwiX21lYXN1cmVtZW50cyIsIk1BUkdJTl9PRl9FUlJPUl9TRUNPTkRTIiwiTE9PUF9USU1FT1VUX0lOVEVSVkFMX01TIiwiTUFYX1JVTk5JTkdfVFJBTlNBQ1RJT05TIiwiU3RhbGxUcmFja2luZ0luc3RydW1lbnRhdGlvbiIsIm9wdGlvbnMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJtaW5pbXVtU3RhbGxUaHJlc2hvbGQiLCJfY2xhc3NDYWxsQ2hlY2syIiwiZGVmYXVsdCIsImlzVHJhY2tpbmciLCJfdG90YWxTdGFsbFRpbWUiLCJfc3RhbGxDb3VudCIsIl9sYXN0SW50ZXJ2YWxNcyIsIl90aW1lb3V0IiwiX3N0YXRzQnlUcmFuc2FjdGlvbiIsIk1hcCIsIl9taW5pbXVtU3RhbGxUaHJlc2hvbGQiLCJfY3JlYXRlQ2xhc3MyIiwia2V5IiwidmFsdWUiLCJzZXR1cE9uY2UiLCJvblRyYW5zYWN0aW9uU3RhcnQiLCJ0cmFuc2FjdGlvbiIsIl90aGlzIiwiaGFzIiwibG9nZ2VyIiwiZXJyb3IiLCJfc3RhcnRUcmFja2luZyIsInNldCIsImxvbmdlc3RTdGFsbFRpbWUiLCJhdFRpbWVzdGFtcCIsImF0U3RhcnQiLCJfZ2V0Q3VycmVudFN0YXRzIiwiX2ZsdXNoTGVha2VkVHJhbnNhY3Rpb25zIiwic3BhblJlY29yZGVyIiwib3JpZ2luYWxBZGQiLCJhZGQiLCJzcGFuIiwiYXBwbHkiLCJvcmlnaW5hbFNwYW5GaW5pc2giLCJmaW5pc2giLCJlbmRUaW1lc3RhbXAiLCJfbWFya1NwYW5GaW5pc2giLCJvblRyYW5zYWN0aW9uRmluaXNoIiwicGFzc2VkRW5kVGltZXN0YW1wIiwidHJhbnNhY3Rpb25TdGF0cyIsImdldCIsImxvZyIsImRlbGV0ZSIsIl9zaG91bGRTdG9wVHJhY2tpbmciLCJzcGFucyIsImZpbmlzaGVkU3BhbkNvdW50IiwicmVkdWNlIiwiY291bnQiLCJzIiwidHJpbUVuZCIsInRvQ29udGV4dCIsImVuZFdpbGxCZVRyaW1tZWQiLCJpc0lkbGVUcmFuc2FjdGlvbiIsInN0YXRzT25GaW5pc2giLCJzcGFuc1dpbGxCZUNhbmNlbGxlZCIsInNvbWUiLCJzdGFydFRpbWVzdGFtcCIsInN0YXRzIiwic2V0TWVhc3VyZW1lbnQiLCJTVEFMTF9DT1VOVCIsInN0YWxsX2NvdW50IiwidW5pdCIsIlNUQUxMX1RPVEFMX1RJTUUiLCJzdGFsbF90b3RhbF90aW1lIiwiU1RBTExfTE9OR0VTVF9USU1FIiwic3RhbGxfbG9uZ2VzdF90aW1lIiwic3BhbkVuZFRpbWVzdGFtcCIsInByZXZpb3VzU3RhdHMiLCJNYXRoIiwiYWJzIiwidGltZXN0YW1wSW5TZWNvbmRzIiwidGltZXN0YW1wIiwiT2JqZWN0IiwiYXNzaWduIiwiX2IiLCJfYSIsImZsb29yIiwiX2l0ZXJhdGlvbiIsIl9zdG9wVHJhY2tpbmciLCJjbGVhclRpbWVvdXQiLCJfcmVzZXQiLCJzaXplIiwiY2xlYXIiLCJub3ciLCJ0b3RhbFRpbWVUYWtlbiIsInN0YWxsVGltZSIsIl9yZWYiLCJlbnRyaWVzIiwiX3JlZjIiLCJfc2xpY2VkVG9BcnJheTIiLCJtYXgiLCJzZXRUaW1lb3V0IiwiYmluZCIsImNvdW50ZXIiLCJsZW4iLCJ0cmFuc2FjdGlvbnMiLCJrZXlzIiwidCIsImV4cG9ydHMiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvanMvdHJhY2luZy9zdGFsbHRyYWNraW5nLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIG1heC1saW5lcyAqL1xuaW1wb3J0IHR5cGUgeyBJZGxlVHJhbnNhY3Rpb24sIFNwYW4sIFRyYW5zYWN0aW9uIH0gZnJvbSAnQHNlbnRyeS9jb3JlJztcbmltcG9ydCB0eXBlIHsgTWVhc3VyZW1lbnRzLCBNZWFzdXJlbWVudFVuaXQgfSBmcm9tICdAc2VudHJ5L3R5cGVzJztcbmltcG9ydCB7IGxvZ2dlciwgdGltZXN0YW1wSW5TZWNvbmRzIH0gZnJvbSAnQHNlbnRyeS91dGlscyc7XG5cbmltcG9ydCB7IFNUQUxMX0NPVU5ULCBTVEFMTF9MT05HRVNUX1RJTUUsIFNUQUxMX1RPVEFMX1RJTUUgfSBmcm9tICcuLi9tZWFzdXJlbWVudHMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFN0YWxsTWVhc3VyZW1lbnRzIGV4dGVuZHMgTWVhc3VyZW1lbnRzIHtcbiAgW1NUQUxMX0NPVU5UXTogeyB2YWx1ZTogbnVtYmVyOyB1bml0OiBNZWFzdXJlbWVudFVuaXQgfTtcbiAgW1NUQUxMX1RPVEFMX1RJTUVdOiB7IHZhbHVlOiBudW1iZXI7IHVuaXQ6IE1lYXN1cmVtZW50VW5pdCB9O1xuICBbU1RBTExfTE9OR0VTVF9USU1FXTogeyB2YWx1ZTogbnVtYmVyOyB1bml0OiBNZWFzdXJlbWVudFVuaXQgfTtcbn1cblxuZXhwb3J0IHR5cGUgU3RhbGxUcmFja2luZ09wdGlvbnMgPSB7XG4gIC8qKlxuICAgKiBIb3cgbG9uZyBpbiBtaWxsaXNlY29uZHMgYW4gZXZlbnQgbG9vcCBpdGVyYXRpb24gY2FuIGJlIGRlbGF5ZWQgZm9yIGJlZm9yZSBiZWluZyBjb25zaWRlcmVkIGEgXCJzdGFsbC5cIlxuICAgKiBAZGVmYXVsdCAxMDBcbiAgICovXG4gIG1pbmltdW1TdGFsbFRocmVzaG9sZDogbnVtYmVyO1xufTtcblxuLyoqIE1hcmdpbiBvZiBlcnJvciBvZiAyMG1zICovXG5jb25zdCBNQVJHSU5fT0ZfRVJST1JfU0VDT05EUyA9IDAuMDI7XG4vKiogSG93IGxvbmcgYmV0d2VlbiBlYWNoIGl0ZXJhdGlvbiBpbiB0aGUgZXZlbnQgbG9vcCB0cmFja2VyIHRpbWVvdXQgKi9cbmNvbnN0IExPT1BfVElNRU9VVF9JTlRFUlZBTF9NUyA9IDUwO1xuLyoqIExpbWl0IGZvciBob3cgbWFueSB0cmFuc2FjdGlvbnMgdGhlIHN0YWxsIHRyYWNrZXIgd2lsbCB0cmFjayBhdCBhIHRpbWUgdG8gcHJldmVudCBsZWFrcyBkdWUgdG8gdHJhbnNhY3Rpb25zIG5vdCBiZWluZyBmaW5pc2hlZCAqL1xuY29uc3QgTUFYX1JVTk5JTkdfVFJBTlNBQ1RJT05TID0gMTA7XG5cbi8qKlxuICogU3RhbGwgbWVhc3VyZW1lbnQgdHJhY2tlciBpbnNwaXJlZCBieSB0aGUgYEpTRXZlbnRMb29wV2F0Y2hkb2dgIHVzZWQgaW50ZXJuYWxseSBpbiBSZWFjdCBOYXRpdmU6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QtbmF0aXZlL2Jsb2IvMDA2ZjVhZmUxMjBjMjkwYTM3Y2Y2ZmY4OTY3NDhmYmMwNjJiZjdlZC9MaWJyYXJpZXMvSW50ZXJhY3Rpb24vSlNFdmVudExvb3BXYXRjaGRvZy5qc1xuICpcbiAqIEhvd2V2ZXIsIHdlIG1vZGlmaWVkIHRoZSBpbnRlcnZhbCBpbXBsZW1lbnRhdGlvbiB0byBpbnN0ZWFkIGhhdmUgYSBmaXhlZCBsb29wIHRpbWVvdXQgaW50ZXJ2YWwgb2YgYExPT1BfVElNRU9VVF9JTlRFUlZBTF9NU2AuXG4gKiBXZSB0aGVuIHdvdWxkIGNvbnNpZGVyIHRoYXQgaXRlcmF0aW9uIGEgc3RhbGwgd2hlbiB0aGUgdG90YWwgdGltZSBmb3IgdGhhdCBpbnRlcnZhbCB0byBydW4gaXMgZ3JlYXRlciB0aGFuIGBMT09QX1RJTUVPVVRfSU5URVJWQUxfTVMgKyBtaW5pbXVtU3RhbGxUaHJlc2hvbGRgXG4gKi9cbmV4cG9ydCBjbGFzcyBTdGFsbFRyYWNraW5nSW5zdHJ1bWVudGF0aW9uIHtcbiAgcHVibGljIGlzVHJhY2tpbmc6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBwcml2YXRlIF9taW5pbXVtU3RhbGxUaHJlc2hvbGQ6IG51bWJlcjtcblxuICAvKiogVG90YWwgYW1vdW50IG9mIHRpbWUgb2YgYWxsIHN0YWxscyB0aGF0IG9jY3VycmVkIGR1cmluZyB0aGUgY3VycmVudCB0cmFja2luZyBzZXNzaW9uICovXG4gIHByaXZhdGUgX3RvdGFsU3RhbGxUaW1lOiBudW1iZXIgPSAwO1xuICAvKiogVG90YWwgbnVtYmVyIG9mIHN0YWxscyB0aGF0IG9jY3VycmVkIGR1cmluZyB0aGUgY3VycmVudCB0cmFja2luZyBzZXNzaW9uICovXG4gIHByaXZhdGUgX3N0YWxsQ291bnQ6IG51bWJlciA9IDA7XG5cbiAgLyoqIFRoZSBsYXN0IHRpbWVzdGFtcCB0aGUgaXRlcmF0aW9uIHJhbiBpbiBtaWxsaXNlY29uZHMgKi9cbiAgcHJpdmF0ZSBfbGFzdEludGVydmFsTXM6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgX3RpbWVvdXQ6IFJldHVyblR5cGU8dHlwZW9mIHNldFRpbWVvdXQ+IHwgbnVsbCA9IG51bGw7XG5cbiAgcHJpdmF0ZSBfc3RhdHNCeVRyYW5zYWN0aW9uOiBNYXA8XG4gICAgVHJhbnNhY3Rpb24sXG4gICAge1xuICAgICAgbG9uZ2VzdFN0YWxsVGltZTogbnVtYmVyO1xuICAgICAgYXRTdGFydDogU3RhbGxNZWFzdXJlbWVudHM7XG4gICAgICBhdFRpbWVzdGFtcDoge1xuICAgICAgICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgICAgICAgc3RhdHM6IFN0YWxsTWVhc3VyZW1lbnRzO1xuICAgICAgfSB8IG51bGw7XG4gICAgfVxuICA+ID0gbmV3IE1hcCgpO1xuXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihvcHRpb25zOiBTdGFsbFRyYWNraW5nT3B0aW9ucyA9IHsgbWluaW11bVN0YWxsVGhyZXNob2xkOiA1MCB9KSB7XG4gICAgdGhpcy5fbWluaW11bVN0YWxsVGhyZXNob2xkID0gb3B0aW9ucy5taW5pbXVtU3RhbGxUaHJlc2hvbGQ7XG4gIH1cblxuICAvKipcbiAgICogQGluaGVyaXREb2NcbiAgICogTm90IHVzZWQgZm9yIHRoaXMgaW50ZWdyYXRpb24uIEluc3RlYWQgY2FsbCBgcmVnaXN0ZXJUcmFuc2FjdGlvblN0YXJ0YCB0byBzdGFydCB0cmFja2luZy5cbiAgICovXG4gIHB1YmxpYyBzZXR1cE9uY2UoKTogdm9pZCB7XG4gICAgLy8gRG8gbm90aGluZy5cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIHRyYW5zYWN0aW9uIGFzIHN0YXJ0ZWQuIFN0YXJ0cyBzdGFsbCB0cmFja2luZyBpZiBub3QgYWxyZWFkeSBydW5uaW5nLlxuICAgKiBAcmV0dXJucyBBIGZpbmlzaCBtZXRob2QgdGhhdCByZXR1cm5zIHRoZSBzdGFsbCBtZWFzdXJlbWVudHMuXG4gICAqL1xuICBwdWJsaWMgb25UcmFuc2FjdGlvblN0YXJ0KHRyYW5zYWN0aW9uOiBUcmFuc2FjdGlvbik6IHZvaWQge1xuICAgIGlmICh0aGlzLl9zdGF0c0J5VHJhbnNhY3Rpb24uaGFzKHRyYW5zYWN0aW9uKSkge1xuICAgICAgbG9nZ2VyLmVycm9yKFxuICAgICAgICAnW1N0YWxsVHJhY2tpbmddIFRyaWVkIHRvIHN0YXJ0IHN0YWxsIHRyYWNraW5nIG9uIGEgdHJhbnNhY3Rpb24gYWxyZWFkeSBiZWluZyB0cmFja2VkLiBNZWFzdXJlbWVudHMgbWlnaHQgYmUgbG9zdC4nLFxuICAgICAgKTtcblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX3N0YXJ0VHJhY2tpbmcoKTtcbiAgICB0aGlzLl9zdGF0c0J5VHJhbnNhY3Rpb24uc2V0KHRyYW5zYWN0aW9uLCB7XG4gICAgICBsb25nZXN0U3RhbGxUaW1lOiAwLFxuICAgICAgYXRUaW1lc3RhbXA6IG51bGwsXG4gICAgICBhdFN0YXJ0OiB0aGlzLl9nZXRDdXJyZW50U3RhdHModHJhbnNhY3Rpb24pLFxuICAgIH0pO1xuICAgIHRoaXMuX2ZsdXNoTGVha2VkVHJhbnNhY3Rpb25zKCk7XG5cbiAgICBpZiAodHJhbnNhY3Rpb24uc3BhblJlY29yZGVyKSB7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L3VuYm91bmQtbWV0aG9kXG4gICAgICBjb25zdCBvcmlnaW5hbEFkZCA9IHRyYW5zYWN0aW9uLnNwYW5SZWNvcmRlci5hZGQ7XG5cbiAgICAgIHRyYW5zYWN0aW9uLnNwYW5SZWNvcmRlci5hZGQgPSAoc3BhbjogU3Bhbik6IHZvaWQgPT4ge1xuICAgICAgICBvcmlnaW5hbEFkZC5hcHBseSh0cmFuc2FjdGlvbi5zcGFuUmVjb3JkZXIsIFtzcGFuXSk7XG5cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC91bmJvdW5kLW1ldGhvZFxuICAgICAgICBjb25zdCBvcmlnaW5hbFNwYW5GaW5pc2ggPSBzcGFuLmZpbmlzaDtcblxuICAgICAgICBzcGFuLmZpbmlzaCA9IChlbmRUaW1lc3RhbXA/OiBudW1iZXIpID0+IHtcbiAgICAgICAgICAvLyBXZSBsZXQgdGhlIHNwYW4gZGV0ZXJtaW5lIGl0cyBvd24gZW5kIHRpbWVzdGFtcCBhcyB3ZWxsIGluIGNhc2UgYW55dGhpbmcgZ2V0cyBjaGFuZ2VkIHVwc3RyZWFtXG4gICAgICAgICAgb3JpZ2luYWxTcGFuRmluaXNoLmFwcGx5KHNwYW4sIFtlbmRUaW1lc3RhbXBdKTtcblxuICAgICAgICAgIC8vIFRoZSBzcGFuIHNob3VsZCBzZXQgYSB0aW1lc3RhbXAsIHNvIHRoaXMgd291bGQgYmUgZGVmaW5lZC5cbiAgICAgICAgICBpZiAoc3Bhbi5lbmRUaW1lc3RhbXApIHtcbiAgICAgICAgICAgIHRoaXMuX21hcmtTcGFuRmluaXNoKHRyYW5zYWN0aW9uLCBzcGFuLmVuZFRpbWVzdGFtcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTG9ncyBhIHRyYW5zYWN0aW9uIGFzIGZpbmlzaGVkLlxuICAgKiBTdG9wcyBzdGFsbCB0cmFja2luZyBpZiBubyBtb3JlIHRyYW5zYWN0aW9ucyBhcmUgcnVubmluZy5cbiAgICogQHJldHVybnMgVGhlIHN0YWxsIG1lYXN1cmVtZW50c1xuICAgKi9cbiAgcHVibGljIG9uVHJhbnNhY3Rpb25GaW5pc2godHJhbnNhY3Rpb246IFRyYW5zYWN0aW9uIHwgSWRsZVRyYW5zYWN0aW9uLCBwYXNzZWRFbmRUaW1lc3RhbXA/OiBudW1iZXIpOiB2b2lkIHtcbiAgICBjb25zdCB0cmFuc2FjdGlvblN0YXRzID0gdGhpcy5fc3RhdHNCeVRyYW5zYWN0aW9uLmdldCh0cmFuc2FjdGlvbik7XG5cbiAgICBpZiAoIXRyYW5zYWN0aW9uU3RhdHMpIHtcbiAgICAgIC8vIFRyYW5zYWN0aW9uIGhhcyBiZWVuIGZsdXNoZWQgb3V0IHNvbWVob3csIHdlIHJldHVybiBudWxsLlxuICAgICAgbG9nZ2VyLmxvZygnW1N0YWxsVHJhY2tpbmddIFN0YWxsIG1lYXN1cmVtZW50cyB3ZXJlIG5vdCBhZGRlZCB0byB0cmFuc2FjdGlvbiBkdWUgdG8gZXhjZWVkaW5nIHRoZSBtYXggY291bnQuJyk7XG5cbiAgICAgIHRoaXMuX3N0YXRzQnlUcmFuc2FjdGlvbi5kZWxldGUodHJhbnNhY3Rpb24pO1xuICAgICAgdGhpcy5fc2hvdWxkU3RvcFRyYWNraW5nKCk7XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBlbmRUaW1lc3RhbXAgPSBwYXNzZWRFbmRUaW1lc3RhbXAgPz8gdHJhbnNhY3Rpb24uZW5kVGltZXN0YW1wO1xuXG4gICAgY29uc3Qgc3BhbnMgPSB0cmFuc2FjdGlvbi5zcGFuUmVjb3JkZXIgPyB0cmFuc2FjdGlvbi5zcGFuUmVjb3JkZXIuc3BhbnMgOiBbXTtcbiAgICBjb25zdCBmaW5pc2hlZFNwYW5Db3VudCA9IHNwYW5zLnJlZHVjZSgoY291bnQsIHMpID0+IChzICE9PSB0cmFuc2FjdGlvbiAmJiBzLmVuZFRpbWVzdGFtcCA/IGNvdW50ICsgMSA6IGNvdW50KSwgMCk7XG5cbiAgICBjb25zdCB0cmltRW5kID0gdHJhbnNhY3Rpb24udG9Db250ZXh0KCkudHJpbUVuZDtcbiAgICBjb25zdCBlbmRXaWxsQmVUcmltbWVkID0gdHJpbUVuZCAmJiBmaW5pc2hlZFNwYW5Db3VudCA+IDA7XG5cbiAgICAvKlxuICAgICAgVGhpcyBpcyBub3Qgc2FmZSBpbiB0aGUgY2FzZSB0aGF0IHNvbWV0aGluZyBjaGFuZ2VzIHVwc3RyZWFtLCBidXQgaWYgd2UncmUgcGxhbm5pbmcgdG8gbW92ZSB0aGlzIG92ZXIgdG8gQHNlbnRyeS9qYXZhc2NyaXB0IGFueXdheXMsXG4gICAgICB3ZSBjYW4gaGF2ZSB0aGlzIHRlbXBvcmFyaWx5IGZvciBub3cuXG4gICAgKi9cbiAgICBjb25zdCBpc0lkbGVUcmFuc2FjdGlvbiA9ICdhY3Rpdml0aWVzJyBpbiB0cmFuc2FjdGlvbjtcblxuICAgIGxldCBzdGF0c09uRmluaXNoOiBTdGFsbE1lYXN1cmVtZW50cyB8IHVuZGVmaW5lZDtcbiAgICBpZiAoZW5kVGltZXN0YW1wICYmIGlzSWRsZVRyYW5zYWN0aW9uKSB7XG4gICAgICAvKlxuICAgICAgICBUaGVyZSBpcyBkaWZmZXJlbnQgYmVoYXZpb3IgcmVnYXJkaW5nIGNoaWxkIHNwYW5zIGluIGEgbm9ybWFsIHRyYW5zYWN0aW9uIGFuZCBhbiBpZGxlIHRyYW5zYWN0aW9uLiBJbiBub3JtYWwgdHJhbnNhY3Rpb25zLFxuICAgICAgICB0aGUgY2hpbGQgc3BhbnMgdGhhdCBhcmVuJ3QgZmluaXNoZWQgd2lsbCBiZSBkdW1wZWQsIHdoaWxlIGluIGFuIGlkbGUgdHJhbnNhY3Rpb24gdGhleSdyZSBjYW5jZWxsZWQgYW5kIGZpbmlzaGVkLlxuXG4gICAgICAgIE5vdGU6IGBlbmRUaW1lc3RhbXBgIHdpbGwgYWx3YXlzIGJlIGRlZmluZWQgaWYgdGhpcyBpcyBjYWxsZWQgb24gYW4gaWRsZSB0cmFuc2FjdGlvbiBmaW5pc2guIFRoaXMgaXMgYmVjYXVzZSB3ZSBvbmx5IGluc3RydW1lbnRcbiAgICAgICAgaWRsZSB0cmFuc2FjdGlvbnMgaW5zaWRlIGBSZWFjdE5hdGl2ZVRyYWNpbmdgLCB3aGljaCB3aWxsIHBhc3MgYW4gYGVuZFRpbWVzdGFtcGAuXG4gICAgICAqL1xuXG4gICAgICAvLyBUaGVyZSB3aWxsIGJlIGNhbmNlbGxlZCBzcGFucywgd2hpY2ggbWVhbnMgdGhhdCB0aGUgZW5kIHdvbid0IGJlIHRyaW1tZWRcbiAgICAgIGNvbnN0IHNwYW5zV2lsbEJlQ2FuY2VsbGVkID0gc3BhbnMuc29tZShcbiAgICAgICAgcyA9PiBzICE9PSB0cmFuc2FjdGlvbiAmJiBzLnN0YXJ0VGltZXN0YW1wIDwgZW5kVGltZXN0YW1wICYmICFzLmVuZFRpbWVzdGFtcCxcbiAgICAgICk7XG5cbiAgICAgIGlmIChlbmRXaWxsQmVUcmltbWVkICYmICFzcGFuc1dpbGxCZUNhbmNlbGxlZCkge1xuICAgICAgICAvLyB0aGUgbGFzdCBzcGFuJ3MgdGltZXN0YW1wIHdpbGwgYmUgdXNlZC5cblxuICAgICAgICBpZiAodHJhbnNhY3Rpb25TdGF0cy5hdFRpbWVzdGFtcCkge1xuICAgICAgICAgIHN0YXRzT25GaW5pc2ggPSB0cmFuc2FjdGlvblN0YXRzLmF0VGltZXN0YW1wLnN0YXRzO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyB0aGlzIGVuZFRpbWVzdGFtcCB3aWxsIGJlIHVzZWQuXG4gICAgICAgIHN0YXRzT25GaW5pc2ggPSB0aGlzLl9nZXRDdXJyZW50U3RhdHModHJhbnNhY3Rpb24pO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZW5kV2lsbEJlVHJpbW1lZCkge1xuICAgICAgLy8gSWYgYHRyaW1FbmRgIGlzIHVzZWQsIGFuZCB0aGVyZSBpcyBhIHNwYW4gdG8gdHJpbSB0by4gSWYgdGhlcmUgaXNuJ3QsIHRoZW4gdGhlIHRyYW5zYWN0aW9uIHNob3VsZCB1c2UgYGVuZFRpbWVzdGFtcGAgb3IgZ2VuZXJhdGUgb25lLlxuICAgICAgaWYgKHRyYW5zYWN0aW9uU3RhdHMuYXRUaW1lc3RhbXApIHtcbiAgICAgICAgc3RhdHNPbkZpbmlzaCA9IHRyYW5zYWN0aW9uU3RhdHMuYXRUaW1lc3RhbXAuc3RhdHM7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICghZW5kVGltZXN0YW1wKSB7XG4gICAgICBzdGF0c09uRmluaXNoID0gdGhpcy5fZ2V0Q3VycmVudFN0YXRzKHRyYW5zYWN0aW9uKTtcbiAgICB9XG5cbiAgICB0aGlzLl9zdGF0c0J5VHJhbnNhY3Rpb24uZGVsZXRlKHRyYW5zYWN0aW9uKTtcbiAgICB0aGlzLl9zaG91bGRTdG9wVHJhY2tpbmcoKTtcblxuICAgIGlmICghc3RhdHNPbkZpbmlzaCkge1xuICAgICAgaWYgKHR5cGVvZiBlbmRUaW1lc3RhbXAgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIGxvZ2dlci5sb2coJ1tTdGFsbFRyYWNraW5nXSBTdGFsbCBtZWFzdXJlbWVudHMgbm90IGFkZGVkIGR1ZSB0byBgZW5kVGltZXN0YW1wYCBiZWluZyBzZXQuJyk7XG4gICAgICB9IGVsc2UgaWYgKHRyaW1FbmQpIHtcbiAgICAgICAgbG9nZ2VyLmxvZyhcbiAgICAgICAgICAnW1N0YWxsVHJhY2tpbmddIFN0YWxsIG1lYXN1cmVtZW50cyBub3QgYWRkZWQgZHVlIHRvIGB0cmltRW5kYCBiZWluZyBzZXQgYnV0IHdlIGNvdWxkIG5vdCBkZXRlcm1pbmUgdGhlIHN0YWxsIG1lYXN1cmVtZW50cyBhdCB0aGF0IHRpbWUuJyxcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRyYW5zYWN0aW9uLnNldE1lYXN1cmVtZW50KFxuICAgICAgU1RBTExfQ09VTlQsXG4gICAgICBzdGF0c09uRmluaXNoLnN0YWxsX2NvdW50LnZhbHVlIC0gdHJhbnNhY3Rpb25TdGF0cy5hdFN0YXJ0LnN0YWxsX2NvdW50LnZhbHVlLFxuICAgICAgdHJhbnNhY3Rpb25TdGF0cy5hdFN0YXJ0LnN0YWxsX2NvdW50LnVuaXQsXG4gICAgKTtcblxuICAgIHRyYW5zYWN0aW9uLnNldE1lYXN1cmVtZW50KFxuICAgICAgU1RBTExfVE9UQUxfVElNRSxcbiAgICAgIHN0YXRzT25GaW5pc2guc3RhbGxfdG90YWxfdGltZS52YWx1ZSAtIHRyYW5zYWN0aW9uU3RhdHMuYXRTdGFydC5zdGFsbF90b3RhbF90aW1lLnZhbHVlLFxuICAgICAgdHJhbnNhY3Rpb25TdGF0cy5hdFN0YXJ0LnN0YWxsX3RvdGFsX3RpbWUudW5pdCxcbiAgICApO1xuXG4gICAgdHJhbnNhY3Rpb24uc2V0TWVhc3VyZW1lbnQoXG4gICAgICBTVEFMTF9MT05HRVNUX1RJTUUsXG4gICAgICBzdGF0c09uRmluaXNoLnN0YWxsX2xvbmdlc3RfdGltZS52YWx1ZSxcbiAgICAgIHN0YXRzT25GaW5pc2guc3RhbGxfbG9uZ2VzdF90aW1lLnVuaXQsXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2dzIHRoZSBmaW5pc2ggdGltZSBvZiB0aGUgc3BhbiBmb3IgdXNlIGluIGB0cmltRW5kOiB0cnVlYCB0cmFuc2FjdGlvbnMuXG4gICAqL1xuICBwcml2YXRlIF9tYXJrU3BhbkZpbmlzaCh0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24sIHNwYW5FbmRUaW1lc3RhbXA6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IHByZXZpb3VzU3RhdHMgPSB0aGlzLl9zdGF0c0J5VHJhbnNhY3Rpb24uZ2V0KHRyYW5zYWN0aW9uKTtcbiAgICBpZiAocHJldmlvdXNTdGF0cykge1xuICAgICAgaWYgKE1hdGguYWJzKHRpbWVzdGFtcEluU2Vjb25kcygpIC0gc3BhbkVuZFRpbWVzdGFtcCkgPiBNQVJHSU5fT0ZfRVJST1JfU0VDT05EUykge1xuICAgICAgICBsb2dnZXIubG9nKFxuICAgICAgICAgICdbU3RhbGxUcmFja2luZ10gU3BhbiBlbmQgbm90IGxvZ2dlZCBkdWUgdG8gZW5kIHRpbWVzdGFtcCBiZWluZyBvdXRzaWRlIHRoZSBtYXJnaW4gb2YgZXJyb3IgZnJvbSBub3cuJyxcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAocHJldmlvdXNTdGF0cy5hdFRpbWVzdGFtcCAmJiBwcmV2aW91c1N0YXRzLmF0VGltZXN0YW1wLnRpbWVzdGFtcCA8IHNwYW5FbmRUaW1lc3RhbXApIHtcbiAgICAgICAgICAvLyBXZSBhbHNvIG5lZWQgdG8gZGVsZXRlIHRoZSBzdGF0IGZvciB0aGUgbGFzdCBzcGFuLCBhcyB0aGUgdHJhbnNhY3Rpb24gd291bGQgYmUgdHJpbW1lZCB0byB0aGlzIHNwYW4gbm90IHRoZSBsYXN0IG9uZS5cbiAgICAgICAgICB0aGlzLl9zdGF0c0J5VHJhbnNhY3Rpb24uc2V0KHRyYW5zYWN0aW9uLCB7XG4gICAgICAgICAgICAuLi5wcmV2aW91c1N0YXRzLFxuICAgICAgICAgICAgYXRUaW1lc3RhbXA6IG51bGwsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX3N0YXRzQnlUcmFuc2FjdGlvbi5zZXQodHJhbnNhY3Rpb24sIHtcbiAgICAgICAgICAuLi5wcmV2aW91c1N0YXRzLFxuICAgICAgICAgIGF0VGltZXN0YW1wOiB7XG4gICAgICAgICAgICB0aW1lc3RhbXA6IHNwYW5FbmRUaW1lc3RhbXAsXG4gICAgICAgICAgICBzdGF0czogdGhpcy5fZ2V0Q3VycmVudFN0YXRzKHRyYW5zYWN0aW9uKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJyZW50IHN0YXRzIGZvciBhIHRyYW5zYWN0aW9uIGF0IGEgZ2l2ZW4gdGltZS5cbiAgICovXG4gIHByaXZhdGUgX2dldEN1cnJlbnRTdGF0cyh0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24pOiBTdGFsbE1lYXN1cmVtZW50cyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YWxsX2NvdW50OiB7IHZhbHVlOiB0aGlzLl9zdGFsbENvdW50LCB1bml0OiAnbm9uZScgfSxcbiAgICAgIHN0YWxsX3RvdGFsX3RpbWU6IHsgdmFsdWU6IHRoaXMuX3RvdGFsU3RhbGxUaW1lLCB1bml0OiAnbWlsbGlzZWNvbmQnIH0sXG4gICAgICBzdGFsbF9sb25nZXN0X3RpbWU6IHtcbiAgICAgICAgdmFsdWU6IHRoaXMuX3N0YXRzQnlUcmFuc2FjdGlvbi5nZXQodHJhbnNhY3Rpb24pPy5sb25nZXN0U3RhbGxUaW1lID8/IDAsXG4gICAgICAgIHVuaXQ6ICdtaWxsaXNlY29uZCcsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgdHJhY2tpbmcgc3RhbGxzXG4gICAqL1xuICBwcml2YXRlIF9zdGFydFRyYWNraW5nKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pc1RyYWNraW5nKSB7XG4gICAgICB0aGlzLmlzVHJhY2tpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5fbGFzdEludGVydmFsTXMgPSBNYXRoLmZsb29yKHRpbWVzdGFtcEluU2Vjb25kcygpICogMTAwMCk7XG5cbiAgICAgIHRoaXMuX2l0ZXJhdGlvbigpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wcyB0aGUgc3RhbGwgdHJhY2tpbmcgaW50ZXJ2YWwgYW5kIGNhbGxzIHJlc2V0KCkuXG4gICAqL1xuICBwcml2YXRlIF9zdG9wVHJhY2tpbmcoKTogdm9pZCB7XG4gICAgdGhpcy5pc1RyYWNraW5nID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5fdGltZW91dCAhPT0gbnVsbCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVvdXQpO1xuICAgICAgdGhpcy5fdGltZW91dCA9IG51bGw7XG4gICAgfVxuXG4gICAgdGhpcy5fcmVzZXQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXaWxsIHN0b3AgdHJhY2tpbmcgaWYgdGhlcmUgYXJlIG5vIG1vcmUgdHJhbnNhY3Rpb25zLlxuICAgKi9cbiAgcHJpdmF0ZSBfc2hvdWxkU3RvcFRyYWNraW5nKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLl9zdGF0c0J5VHJhbnNhY3Rpb24uc2l6ZSA9PT0gMCkge1xuICAgICAgdGhpcy5fc3RvcFRyYWNraW5nKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsZWFycyBhbGwgdGhlIGNvbGxlY3RlZCBzdGF0c1xuICAgKi9cbiAgcHJpdmF0ZSBfcmVzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5fc3RhbGxDb3VudCA9IDA7XG4gICAgdGhpcy5fdG90YWxTdGFsbFRpbWUgPSAwO1xuICAgIHRoaXMuX2xhc3RJbnRlcnZhbE1zID0gMDtcbiAgICB0aGlzLl9zdGF0c0J5VHJhbnNhY3Rpb24uY2xlYXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJdGVyYXRpb24gb2YgdGhlIHN0YWxsIHRyYWNraW5nIGludGVydmFsLiBNZWFzdXJlcyBob3cgbG9uZyB0aGUgdGltZXIgc3RyYXllZCBmcm9tIGl0cyBleHBlY3RlZCB0aW1lIG9mIHJ1bm5pbmcsIGFuZCBob3dcbiAgICogbG9uZyB0aGUgc3RhbGwgaXMgZm9yLlxuICAgKi9cbiAgcHJpdmF0ZSBfaXRlcmF0aW9uKCk6IHZvaWQge1xuICAgIGNvbnN0IG5vdyA9IHRpbWVzdGFtcEluU2Vjb25kcygpICogMTAwMDtcbiAgICBjb25zdCB0b3RhbFRpbWVUYWtlbiA9IG5vdyAtIHRoaXMuX2xhc3RJbnRlcnZhbE1zO1xuXG4gICAgaWYgKHRvdGFsVGltZVRha2VuID49IExPT1BfVElNRU9VVF9JTlRFUlZBTF9NUyArIHRoaXMuX21pbmltdW1TdGFsbFRocmVzaG9sZCkge1xuICAgICAgY29uc3Qgc3RhbGxUaW1lID0gdG90YWxUaW1lVGFrZW4gLSBMT09QX1RJTUVPVVRfSU5URVJWQUxfTVM7XG4gICAgICB0aGlzLl9zdGFsbENvdW50ICs9IDE7XG4gICAgICB0aGlzLl90b3RhbFN0YWxsVGltZSArPSBzdGFsbFRpbWU7XG5cbiAgICAgIGZvciAoY29uc3QgW3RyYW5zYWN0aW9uLCB2YWx1ZV0gb2YgdGhpcy5fc3RhdHNCeVRyYW5zYWN0aW9uLmVudHJpZXMoKSkge1xuICAgICAgICBjb25zdCBsb25nZXN0U3RhbGxUaW1lID0gTWF0aC5tYXgodmFsdWUubG9uZ2VzdFN0YWxsVGltZSA/PyAwLCBzdGFsbFRpbWUpO1xuXG4gICAgICAgIHRoaXMuX3N0YXRzQnlUcmFuc2FjdGlvbi5zZXQodHJhbnNhY3Rpb24sIHtcbiAgICAgICAgICAuLi52YWx1ZSxcbiAgICAgICAgICBsb25nZXN0U3RhbGxUaW1lLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLl9sYXN0SW50ZXJ2YWxNcyA9IG5vdztcblxuICAgIGlmICh0aGlzLmlzVHJhY2tpbmcpIHtcbiAgICAgIHRoaXMuX3RpbWVvdXQgPSBzZXRUaW1lb3V0KHRoaXMuX2l0ZXJhdGlvbi5iaW5kKHRoaXMpLCBMT09QX1RJTUVPVVRfSU5URVJWQUxfTVMpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGxlYWtlZCB0cmFuc2FjdGlvbnMgKEVhcmxpZXN0IHRyYW5zYWN0aW9ucyB3aGVuIHdlIGhhdmUgbW9yZSB0aGFuIE1BWF9SVU5OSU5HX1RSQU5TQUNUSU9OUyB0cmFuc2FjdGlvbnMuKVxuICAgKi9cbiAgcHJpdmF0ZSBfZmx1c2hMZWFrZWRUcmFuc2FjdGlvbnMoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuX3N0YXRzQnlUcmFuc2FjdGlvbi5zaXplID4gTUFYX1JVTk5JTkdfVFJBTlNBQ1RJT05TKSB7XG4gICAgICBsZXQgY291bnRlciA9IDA7XG4gICAgICBjb25zdCBsZW4gPSB0aGlzLl9zdGF0c0J5VHJhbnNhY3Rpb24uc2l6ZSAtIE1BWF9SVU5OSU5HX1RSQU5TQUNUSU9OUztcbiAgICAgIGNvbnN0IHRyYW5zYWN0aW9ucyA9IHRoaXMuX3N0YXRzQnlUcmFuc2FjdGlvbi5rZXlzKCk7XG4gICAgICBmb3IgKGNvbnN0IHQgb2YgdHJhbnNhY3Rpb25zKSB7XG4gICAgICAgIGlmIChjb3VudGVyID49IGxlbikgYnJlYWs7XG4gICAgICAgIGNvdW50ZXIgKz0gMTtcbiAgICAgICAgdGhpcy5fc3RhdHNCeVRyYW5zYWN0aW9uLmRlbGV0ZSh0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFHQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFFQSxJQUFBQyxhQUFBLEdBQUFELE9BQUE7QUFpQkEsSUFBTUUsdUJBQXVCLEdBQUcsSUFBSTtBQUVwQyxJQUFNQyx3QkFBd0IsR0FBRyxFQUFFO0FBRW5DLElBQU1DLHdCQUF3QixHQUFHLEVBQUU7QUFBQyxJQVN2QkMsNEJBQTRCO0VBMEJ2QyxTQUFBQSw2QkFBQSxFQUFnRjtJQUFBLElBQTdEQyxPQUFBLEdBQUFDLFNBQUEsQ0FBQUMsTUFBQSxRQUFBRCxTQUFBLFFBQUFFLFNBQUEsR0FBQUYsU0FBQSxNQUFnQztNQUFFRyxxQkFBcUIsRUFBRTtJQUFFLENBQUU7SUFBQSxJQUFBQyxnQkFBQSxDQUFBQyxPQUFBLFFBQUFQLDRCQUFBO0lBekJ6RSxLQUFBUSxVQUFVLEdBQVksS0FBSztJQUsxQixLQUFBQyxlQUFlLEdBQVcsQ0FBQztJQUUzQixLQUFBQyxXQUFXLEdBQVcsQ0FBQztJQUd2QixLQUFBQyxlQUFlLEdBQVcsQ0FBQztJQUMzQixLQUFBQyxRQUFRLEdBQXlDLElBQUk7SUFFckQsS0FBQUMsbUJBQW1CLEdBVXZCLElBQUlDLEdBQUcsRUFBRTtJQUdYLElBQUksQ0FBQ0Msc0JBQXNCLEdBQUdkLE9BQU8sQ0FBQ0kscUJBQXFCO0VBQzdEO0VBQUMsSUFBQVcsYUFBQSxDQUFBVCxPQUFBLEVBQUFQLDRCQUFBO0lBQUFpQixHQUFBO0lBQUFDLEtBQUEsRUFNTSxTQUFBQyxVQUFBLEVBQVMsQ0FFaEI7RUFBQztJQUFBRixHQUFBO0lBQUFDLEtBQUEsRUFNTSxTQUFBRSxtQkFBbUJDLFdBQXdCO01BQUEsSUFBQUMsS0FBQTtNQUNoRCxJQUFJLElBQUksQ0FBQ1QsbUJBQW1CLENBQUNVLEdBQUcsQ0FBQ0YsV0FBVyxDQUFDLEVBQUU7UUFDN0NHLGFBQU0sQ0FBQ0MsS0FBSyxDQUNWLG1IQUFtSCxDQUNwSDtRQUVEOztNQUdGLElBQUksQ0FBQ0MsY0FBYyxFQUFFO01BQ3JCLElBQUksQ0FBQ2IsbUJBQW1CLENBQUNjLEdBQUcsQ0FBQ04sV0FBVyxFQUFFO1FBQ3hDTyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ25CQyxXQUFXLEVBQUUsSUFBSTtRQUNqQkMsT0FBTyxFQUFFLElBQUksQ0FBQ0MsZ0JBQWdCLENBQUNWLFdBQVc7T0FDM0MsQ0FBQztNQUNGLElBQUksQ0FBQ1csd0JBQXdCLEVBQUU7TUFFL0IsSUFBSVgsV0FBVyxDQUFDWSxZQUFZLEVBQUU7UUFFNUIsSUFBTUMsV0FBVyxHQUFHYixXQUFXLENBQUNZLFlBQVksQ0FBQ0UsR0FBRztRQUVoRGQsV0FBVyxDQUFDWSxZQUFZLENBQUNFLEdBQUcsR0FBRyxVQUFDQyxJQUFVLEVBQVU7VUFDbERGLFdBQVcsQ0FBQ0csS0FBSyxDQUFDaEIsV0FBVyxDQUFDWSxZQUFZLEVBQUUsQ0FBQ0csSUFBSSxDQUFDLENBQUM7VUFHbkQsSUFBTUUsa0JBQWtCLEdBQUdGLElBQUksQ0FBQ0csTUFBTTtVQUV0Q0gsSUFBSSxDQUFDRyxNQUFNLEdBQUcsVUFBQ0MsWUFBcUIsRUFBSTtZQUV0Q0Ysa0JBQWtCLENBQUNELEtBQUssQ0FBQ0QsSUFBSSxFQUFFLENBQUNJLFlBQVksQ0FBQyxDQUFDO1lBRzlDLElBQUlKLElBQUksQ0FBQ0ksWUFBWSxFQUFFO2NBQ3JCbEIsS0FBSSxDQUFDbUIsZUFBZSxDQUFDcEIsV0FBVyxFQUFFZSxJQUFJLENBQUNJLFlBQVksQ0FBQzs7VUFFeEQsQ0FBQztRQUNILENBQUM7O0lBRUw7RUFBQztJQUFBdkIsR0FBQTtJQUFBQyxLQUFBLEVBT00sU0FBQXdCLG9CQUFvQnJCLFdBQTBDLEVBQUVzQixrQkFBMkI7TUFDaEcsSUFBTUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDL0IsbUJBQW1CLENBQUNnQyxHQUFHLENBQUN4QixXQUFXLENBQUM7TUFFbEUsSUFBSSxDQUFDdUIsZ0JBQWdCLEVBQUU7UUFFckJwQixhQUFNLENBQUNzQixHQUFHLENBQUMsa0dBQWtHLENBQUM7UUFFOUcsSUFBSSxDQUFDakMsbUJBQW1CLENBQUNrQyxNQUFNLENBQUMxQixXQUFXLENBQUM7UUFDNUMsSUFBSSxDQUFDMkIsbUJBQW1CLEVBQUU7UUFFMUI7O01BR0YsSUFBTVIsWUFBWSxHQUFHRyxrQkFBa0IsYUFBbEJBLGtCQUFrQixjQUFsQkEsa0JBQWtCLEdBQUl0QixXQUFXLENBQUNtQixZQUFZO01BRW5FLElBQU1TLEtBQUssR0FBRzVCLFdBQVcsQ0FBQ1ksWUFBWSxHQUFHWixXQUFXLENBQUNZLFlBQVksQ0FBQ2dCLEtBQUssR0FBRyxFQUFFO01BQzVFLElBQU1DLGlCQUFpQixHQUFHRCxLQUFLLENBQUNFLE1BQU0sQ0FBQyxVQUFDQyxLQUFLLEVBQUVDLENBQUM7UUFBQSxPQUFNQSxDQUFDLEtBQUtoQyxXQUFXLElBQUlnQyxDQUFDLENBQUNiLFlBQVksR0FBR1ksS0FBSyxHQUFHLENBQUMsR0FBR0EsS0FBSztNQUFBLENBQUMsRUFBRSxDQUFDLENBQUM7TUFFbEgsSUFBTUUsT0FBTyxHQUFHakMsV0FBVyxDQUFDa0MsU0FBUyxFQUFFLENBQUNELE9BQU87TUFDL0MsSUFBTUUsZ0JBQWdCLEdBQUdGLE9BQU8sSUFBSUosaUJBQWlCLEdBQUcsQ0FBQztNQU16RCxJQUFNTyxpQkFBaUIsSUFBRyxZQUFZLElBQUlwQyxXQUFXO01BRXJELElBQUlxQyxhQUE0QztNQUNoRCxJQUFJbEIsWUFBWSxJQUFJaUIsaUJBQWlCLEVBQUU7UUFVckMsSUFBTUUsb0JBQW9CLEdBQUdWLEtBQUssQ0FBQ1csSUFBSSxDQUNyQyxVQUFBUCxDQUFDO1VBQUEsT0FBSUEsQ0FBQyxLQUFLaEMsV0FBVyxJQUFJZ0MsQ0FBQyxDQUFDUSxjQUFjLEdBQUdyQixZQUFZLElBQUksQ0FBQ2EsQ0FBQyxDQUFDYixZQUFZO1FBQUEsRUFDN0U7UUFFRCxJQUFJZ0IsZ0JBQWdCLElBQUksQ0FBQ0csb0JBQW9CLEVBQUU7VUFHN0MsSUFBSWYsZ0JBQWdCLENBQUNmLFdBQVcsRUFBRTtZQUNoQzZCLGFBQWEsR0FBR2QsZ0JBQWdCLENBQUNmLFdBQVcsQ0FBQ2lDLEtBQUs7O1NBRXJELE1BQU07VUFFTEosYUFBYSxHQUFHLElBQUksQ0FBQzNCLGdCQUFnQixDQUFDVixXQUFXLENBQUM7O09BRXJELE1BQU0sSUFBSW1DLGdCQUFnQixFQUFFO1FBRTNCLElBQUlaLGdCQUFnQixDQUFDZixXQUFXLEVBQUU7VUFDaEM2QixhQUFhLEdBQUdkLGdCQUFnQixDQUFDZixXQUFXLENBQUNpQyxLQUFLOztPQUVyRCxNQUFNLElBQUksQ0FBQ3RCLFlBQVksRUFBRTtRQUN4QmtCLGFBQWEsR0FBRyxJQUFJLENBQUMzQixnQkFBZ0IsQ0FBQ1YsV0FBVyxDQUFDOztNQUdwRCxJQUFJLENBQUNSLG1CQUFtQixDQUFDa0MsTUFBTSxDQUFDMUIsV0FBVyxDQUFDO01BQzVDLElBQUksQ0FBQzJCLG1CQUFtQixFQUFFO01BRTFCLElBQUksQ0FBQ1UsYUFBYSxFQUFFO1FBQ2xCLElBQUksT0FBT2xCLFlBQVksS0FBSyxXQUFXLEVBQUU7VUFDdkNoQixhQUFNLENBQUNzQixHQUFHLENBQUMsK0VBQStFLENBQUM7U0FDNUYsTUFBTSxJQUFJUSxPQUFPLEVBQUU7VUFDbEI5QixhQUFNLENBQUNzQixHQUFHLENBQ1IseUlBQXlJLENBQzFJOztRQUdIOztNQUdGekIsV0FBVyxDQUFDMEMsY0FBYyxDQUN4QkMseUJBQVcsRUFDWE4sYUFBYSxDQUFDTyxXQUFXLENBQUMvQyxLQUFLLEdBQUcwQixnQkFBZ0IsQ0FBQ2QsT0FBTyxDQUFDbUMsV0FBVyxDQUFDL0MsS0FBSyxFQUM1RTBCLGdCQUFnQixDQUFDZCxPQUFPLENBQUNtQyxXQUFXLENBQUNDLElBQUksQ0FDMUM7TUFFRDdDLFdBQVcsQ0FBQzBDLGNBQWMsQ0FDeEJJLDhCQUFnQixFQUNoQlQsYUFBYSxDQUFDVSxnQkFBZ0IsQ0FBQ2xELEtBQUssR0FBRzBCLGdCQUFnQixDQUFDZCxPQUFPLENBQUNzQyxnQkFBZ0IsQ0FBQ2xELEtBQUssRUFDdEYwQixnQkFBZ0IsQ0FBQ2QsT0FBTyxDQUFDc0MsZ0JBQWdCLENBQUNGLElBQUksQ0FDL0M7TUFFRDdDLFdBQVcsQ0FBQzBDLGNBQWMsQ0FDeEJNLGdDQUFrQixFQUNsQlgsYUFBYSxDQUFDWSxrQkFBa0IsQ0FBQ3BELEtBQUssRUFDdEN3QyxhQUFhLENBQUNZLGtCQUFrQixDQUFDSixJQUFJLENBQ3RDO0lBQ0g7RUFBQztJQUFBakQsR0FBQTtJQUFBQyxLQUFBLEVBS08sU0FBQXVCLGdCQUFnQnBCLFdBQXdCLEVBQUVrRCxnQkFBd0I7TUFDeEUsSUFBTUMsYUFBYSxHQUFHLElBQUksQ0FBQzNELG1CQUFtQixDQUFDZ0MsR0FBRyxDQUFDeEIsV0FBVyxDQUFDO01BQy9ELElBQUltRCxhQUFhLEVBQUU7UUFDakIsSUFBSUMsSUFBSSxDQUFDQyxHQUFHLENBQUMsSUFBQUMseUJBQWtCLEdBQUUsR0FBR0osZ0JBQWdCLENBQUMsR0FBRzFFLHVCQUF1QixFQUFFO1VBQy9FMkIsYUFBTSxDQUFDc0IsR0FBRyxDQUNSLHNHQUFzRyxDQUN2RztVQUVELElBQUkwQixhQUFhLENBQUMzQyxXQUFXLElBQUkyQyxhQUFhLENBQUMzQyxXQUFXLENBQUMrQyxTQUFTLEdBQUdMLGdCQUFnQixFQUFFO1lBRXZGLElBQUksQ0FBQzFELG1CQUFtQixDQUFDYyxHQUFHLENBQUNOLFdBQVcsRUFBQXdELE1BQUEsQ0FBQUMsTUFBQSxDQUFBRCxNQUFBLENBQUFDLE1BQUEsS0FDbkNOLGFBQWE7Y0FDaEIzQyxXQUFXLEVBQUU7WUFBSSxHQUNqQjs7U0FFTCxNQUFNO1VBQ0wsSUFBSSxDQUFDaEIsbUJBQW1CLENBQUNjLEdBQUcsQ0FBQ04sV0FBVyxFQUFBd0QsTUFBQSxDQUFBQyxNQUFBLENBQUFELE1BQUEsQ0FBQUMsTUFBQSxLQUNuQ04sYUFBYTtZQUNoQjNDLFdBQVcsRUFBRTtjQUNYK0MsU0FBUyxFQUFFTCxnQkFBZ0I7Y0FDM0JULEtBQUssRUFBRSxJQUFJLENBQUMvQixnQkFBZ0IsQ0FBQ1YsV0FBVzs7VUFDekMsR0FDRDs7O0lBR1I7RUFBQztJQUFBSixHQUFBO0lBQUFDLEtBQUEsRUFLTyxTQUFBYSxpQkFBaUJWLFdBQXdCOztNQUMvQyxPQUFPO1FBQ0w0QyxXQUFXLEVBQUU7VUFBRS9DLEtBQUssRUFBRSxJQUFJLENBQUNSLFdBQVc7VUFBRXdELElBQUksRUFBRTtRQUFNLENBQUU7UUFDdERFLGdCQUFnQixFQUFFO1VBQUVsRCxLQUFLLEVBQUUsSUFBSSxDQUFDVCxlQUFlO1VBQUV5RCxJQUFJLEVBQUU7UUFBYSxDQUFFO1FBQ3RFSSxrQkFBa0IsRUFBRTtVQUNsQnBELEtBQUssR0FBQTZELEVBQUEsSUFBQUMsRUFBQSxHQUFFLElBQUksQ0FBQ25FLG1CQUFtQixDQUFDZ0MsR0FBRyxDQUFDeEIsV0FBVyxDQUFDLGNBQUEyRCxFQUFBLHVCQUFBQSxFQUFBLENBQUVwRCxnQkFBZ0IsY0FBQW1ELEVBQUEsY0FBQUEsRUFBQSxHQUFJLENBQUM7VUFDdkViLElBQUksRUFBRTs7T0FFVDtJQUNIO0VBQUM7SUFBQWpELEdBQUE7SUFBQUMsS0FBQSxFQUtPLFNBQUFRLGVBQUEsRUFBYztNQUNwQixJQUFJLENBQUMsSUFBSSxDQUFDbEIsVUFBVSxFQUFFO1FBQ3BCLElBQUksQ0FBQ0EsVUFBVSxHQUFHLElBQUk7UUFDdEIsSUFBSSxDQUFDRyxlQUFlLEdBQUc4RCxJQUFJLENBQUNRLEtBQUssQ0FBQyxJQUFBTix5QkFBa0IsR0FBRSxHQUFHLElBQUksQ0FBQztRQUU5RCxJQUFJLENBQUNPLFVBQVUsRUFBRTs7SUFFckI7RUFBQztJQUFBakUsR0FBQTtJQUFBQyxLQUFBLEVBS08sU0FBQWlFLGNBQUEsRUFBYTtNQUNuQixJQUFJLENBQUMzRSxVQUFVLEdBQUcsS0FBSztNQUV2QixJQUFJLElBQUksQ0FBQ0ksUUFBUSxLQUFLLElBQUksRUFBRTtRQUMxQndFLFlBQVksQ0FBQyxJQUFJLENBQUN4RSxRQUFRLENBQUM7UUFDM0IsSUFBSSxDQUFDQSxRQUFRLEdBQUcsSUFBSTs7TUFHdEIsSUFBSSxDQUFDeUUsTUFBTSxFQUFFO0lBQ2Y7RUFBQztJQUFBcEUsR0FBQTtJQUFBQyxLQUFBLEVBS08sU0FBQThCLG9CQUFBLEVBQW1CO01BQ3pCLElBQUksSUFBSSxDQUFDbkMsbUJBQW1CLENBQUN5RSxJQUFJLEtBQUssQ0FBQyxFQUFFO1FBQ3ZDLElBQUksQ0FBQ0gsYUFBYSxFQUFFOztJQUV4QjtFQUFDO0lBQUFsRSxHQUFBO0lBQUFDLEtBQUEsRUFLTyxTQUFBbUUsT0FBQSxFQUFNO01BQ1osSUFBSSxDQUFDM0UsV0FBVyxHQUFHLENBQUM7TUFDcEIsSUFBSSxDQUFDRCxlQUFlLEdBQUcsQ0FBQztNQUN4QixJQUFJLENBQUNFLGVBQWUsR0FBRyxDQUFDO01BQ3hCLElBQUksQ0FBQ0UsbUJBQW1CLENBQUMwRSxLQUFLLEVBQUU7SUFDbEM7RUFBQztJQUFBdEUsR0FBQTtJQUFBQyxLQUFBLEVBTU8sU0FBQWdFLFdBQUEsRUFBVTs7TUFDaEIsSUFBTU0sR0FBRyxHQUFHLElBQUFiLHlCQUFrQixHQUFFLEdBQUcsSUFBSTtNQUN2QyxJQUFNYyxjQUFjLEdBQUdELEdBQUcsR0FBRyxJQUFJLENBQUM3RSxlQUFlO01BRWpELElBQUk4RSxjQUFjLElBQUkzRix3QkFBd0IsR0FBRyxJQUFJLENBQUNpQixzQkFBc0IsRUFBRTtRQUM1RSxJQUFNMkUsU0FBUyxHQUFHRCxjQUFjLEdBQUczRix3QkFBd0I7UUFDM0QsSUFBSSxDQUFDWSxXQUFXLElBQUksQ0FBQztRQUNyQixJQUFJLENBQUNELGVBQWUsSUFBSWlGLFNBQVM7UUFFakMsU0FBQUMsSUFBQSxJQUFtQyxJQUFJLENBQUM5RSxtQkFBbUIsQ0FBQytFLE9BQU8sRUFBRSxFQUFFO1VBQUEsSUFBQUMsS0FBQSxPQUFBQyxlQUFBLENBQUF2RixPQUFBLEVBQUFvRixJQUFBO1VBQUEsSUFBM0R0RSxXQUFXLEdBQUF3RSxLQUFBO1VBQUEsSUFBRTNFLEtBQUssR0FBQTJFLEtBQUE7VUFDNUIsSUFBTWpFLGdCQUFnQixHQUFHNkMsSUFBSSxDQUFDc0IsR0FBRyxFQUFBZixFQUFBLEdBQUM5RCxLQUFLLENBQUNVLGdCQUFnQixjQUFBb0QsRUFBQSxjQUFBQSxFQUFBLEdBQUksQ0FBQyxFQUFFVSxTQUFTLENBQUM7VUFFekUsSUFBSSxDQUFDN0UsbUJBQW1CLENBQUNjLEdBQUcsQ0FBQ04sV0FBVyxFQUFBd0QsTUFBQSxDQUFBQyxNQUFBLENBQUFELE1BQUEsQ0FBQUMsTUFBQSxLQUNuQzVELEtBQUs7WUFDUlUsZ0JBQWdCLEVBQWhCQTtVQUFnQixHQUNoQjs7O01BSU4sSUFBSSxDQUFDakIsZUFBZSxHQUFHNkUsR0FBRztNQUUxQixJQUFJLElBQUksQ0FBQ2hGLFVBQVUsRUFBRTtRQUNuQixJQUFJLENBQUNJLFFBQVEsR0FBR29GLFVBQVUsQ0FBQyxJQUFJLENBQUNkLFVBQVUsQ0FBQ2UsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFbkcsd0JBQXdCLENBQUM7O0lBRXBGO0VBQUM7SUFBQW1CLEdBQUE7SUFBQUMsS0FBQSxFQUtPLFNBQUFjLHlCQUFBLEVBQXdCO01BQzlCLElBQUksSUFBSSxDQUFDbkIsbUJBQW1CLENBQUN5RSxJQUFJLEdBQUd2Rix3QkFBd0IsRUFBRTtRQUM1RCxJQUFJbUcsT0FBTyxHQUFHLENBQUM7UUFDZixJQUFNQyxHQUFHLEdBQUcsSUFBSSxDQUFDdEYsbUJBQW1CLENBQUN5RSxJQUFJLEdBQUd2Rix3QkFBd0I7UUFDcEUsSUFBTXFHLFlBQVksR0FBRyxJQUFJLENBQUN2RixtQkFBbUIsQ0FBQ3dGLElBQUksRUFBRTtRQUNwRCxLQUFLLElBQU1DLENBQUMsSUFBSUYsWUFBWSxFQUFFO1VBQzVCLElBQUlGLE9BQU8sSUFBSUMsR0FBRyxFQUFFO1VBQ3BCRCxPQUFPLElBQUksQ0FBQztVQUNaLElBQUksQ0FBQ3JGLG1CQUFtQixDQUFDa0MsTUFBTSxDQUFDdUQsQ0FBQyxDQUFDOzs7SUFHeEM7RUFBQztFQUFBLE9BQUF0Ryw0QkFBQTtBQUFBO0FBQUF1RyxPQUFBLENBQUF2Ryw0QkFBQSxHQUFBQSw0QkFBQSJ9