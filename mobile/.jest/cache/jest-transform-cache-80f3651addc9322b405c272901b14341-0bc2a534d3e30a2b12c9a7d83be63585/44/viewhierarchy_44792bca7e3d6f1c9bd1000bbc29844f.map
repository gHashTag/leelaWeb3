{"version":3,"names":["_utils","require","_wrapper","ViewHierarchy","_classCallCheck2","default","name","id","_createClass2","key","value","setupOnce","addGlobalEventProcessor","_this","event","hint","__awaiter","hasException","exception","values","length","viewHierarchy","NATIVE","fetchViewHierarchy","e","logger","error","attachments","filename","_fileName","contentType","_contentType","attachmentType","_attachmentType","data","concat","_toConsumableArray2","exports"],"sources":["../../../src/js/integrations/viewhierarchy.ts"],"sourcesContent":["import type { Event, EventHint, EventProcessor, Integration } from '@sentry/types';\nimport { logger } from '@sentry/utils';\n\nimport { NATIVE } from '../wrapper';\n\n/** Adds ViewHierarchy to error events */\nexport class ViewHierarchy implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'ViewHierarchy';\n\n  private static _fileName: string = 'view-hierarchy.json';\n  private static _contentType: string = 'application/json';\n  private static _attachmentType: string = 'event.view_hierarchy';\n\n  /**\n   * @inheritDoc\n   */\n  public name: string = ViewHierarchy.id;\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(addGlobalEventProcessor: (e: EventProcessor) => void): void {\n    addGlobalEventProcessor(async (event: Event, hint: EventHint) => {\n      const hasException = event.exception && event.exception.values && event.exception.values.length > 0;\n      if (!hasException) {\n        return event;\n      }\n\n      let viewHierarchy: Uint8Array | null = null;\n      try {\n        viewHierarchy = await NATIVE.fetchViewHierarchy();\n      } catch (e) {\n        logger.error('Failed to get view hierarchy from native.', e);\n      }\n\n      if (viewHierarchy) {\n        hint.attachments = [\n          {\n            filename: ViewHierarchy._fileName,\n            contentType: ViewHierarchy._contentType,\n            attachmentType: ViewHierarchy._attachmentType,\n            data: viewHierarchy,\n          },\n          ...(hint?.attachments || []),\n        ];\n      }\n\n      return event;\n    });\n  }\n}\n"],"mappings":";;;;;;;;;AACA,IAAAA,MAAA,GAAAC,OAAA;AAEA,IAAAC,QAAA,GAAAD,OAAA;AAAoC,IAGvBE,aAAa;EAA1B,SAAAA,cAAA;IAAA,IAAAC,gBAAA,CAAAC,OAAA,QAAAF,aAAA;IAaS,KAAAG,IAAI,GAAWH,aAAa,CAACI,EAAE;EAkCxC;EAAC,IAAAC,aAAA,CAAAH,OAAA,EAAAF,aAAA;IAAAM,GAAA;IAAAC,KAAA,EA7BQ,SAAAC,UAAUC,uBAAoD;MAAA,IAAAC,KAAA;MACnED,uBAAuB,CAAC,UAAOE,KAAY,EAAEC,IAAe;QAAA,OAAI,IAAAC,gBAAA,EAAAH,KAAA;UAC9D,IAAMI,YAAY,GAAGH,KAAK,CAACI,SAAS,IAAIJ,KAAK,CAACI,SAAS,CAACC,MAAM,IAAIL,KAAK,CAACI,SAAS,CAACC,MAAM,CAACC,MAAM,GAAG,CAAC;UACnG,IAAI,CAACH,YAAY,EAAE;YACjB,OAAOH,KAAK;;UAGd,IAAIO,aAAa,GAAsB,IAAI;UAC3C,IAAI;YACFA,aAAa,GAAG,MAAMC,eAAM,CAACC,kBAAkB,EAAE;WAClD,CAAC,OAAOC,CAAC,EAAE;YACVC,aAAM,CAACC,KAAK,CAAC,2CAA2C,EAAEF,CAAC,CAAC;;UAG9D,IAAIH,aAAa,EAAE;YACjBN,IAAI,CAACY,WAAW,IACd;cACEC,QAAQ,EAAEzB,aAAa,CAAC0B,SAAS;cACjCC,WAAW,EAAE3B,aAAa,CAAC4B,YAAY;cACvCC,cAAc,EAAE7B,aAAa,CAAC8B,eAAe;cAC7CC,IAAI,EAAEb;aACP,EAAAc,MAAA,KAAAC,mBAAA,CAAA/B,OAAA,EACG,CAAAU,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEY,WAAW,KAAI,EAAE,EAC5B;;UAGH,OAAOb,KAAK;QACd,CAAC;MAAA,EAAC;IACJ;EAAC;EAAA,OAAAX,aAAA;AAAA;AAAAkC,OAAA,CAAAlC,aAAA,GAAAA,aAAA;AA1CaA,aAAA,CAAAI,EAAE,GAAW,eAAe;AAE3BJ,aAAA,CAAA0B,SAAS,GAAW,qBAAqB;AACzC1B,aAAA,CAAA4B,YAAY,GAAW,kBAAkB;AACzC5B,aAAA,CAAA8B,eAAe,GAAW,sBAAsB"}