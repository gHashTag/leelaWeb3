{"version":3,"names":["_getTokenTypeByToken","_interopRequireDefault","require","_flattenInlineTokens","_renderInlineAsText","cleanupTokens","tokens","flattenInlineTokens","forEach","token","type","getTokenTypeByToken","block","attrs","attrIndex","renderInlineAsText","children","stack","reduce","acc","index","nesting","push","length","some","stackToken","shift"],"sources":["cleanupTokens.js"],"sourcesContent":["import getTokenTypeByToken from './getTokenTypeByToken';\nimport flattenInlineTokens from './flattenInlineTokens';\nimport renderInlineAsText from './renderInlineAsText';\n\nexport function cleanupTokens(tokens) {\n  tokens = flattenInlineTokens(tokens);\n  tokens.forEach((token) => {\n    token.type = getTokenTypeByToken(token);\n\n    // set image and hardbreak to block elements\n    if (token.type === 'image' || token.type === 'hardbreak') {\n      token.block = true;\n    }\n\n    // Set img alt text\n    if (token.type === 'image') {\n      token.attrs[token.attrIndex('alt')][1] = renderInlineAsText(\n        token.children,\n      );\n    }\n  });\n\n  /**\n   * changing a link token to a blocklink to fix issue where link tokens with\n   * nested non text tokens breaks component\n   */\n  const stack = [];\n  tokens = tokens.reduce((acc, token, index) => {\n    if (token.type === 'link' && token.nesting === 1) {\n      stack.push(token);\n    } else if (\n      stack.length > 0 &&\n      token.type === 'link' &&\n      token.nesting === -1\n    ) {\n      if (stack.some((stackToken) => stackToken.block)) {\n        stack[0].type = 'blocklink';\n        stack[0].block = true;\n        token.type = 'blocklink';\n        token.block = true;\n      }\n\n      stack.push(token);\n\n      while (stack.length) {\n        acc.push(stack.shift());\n      }\n    } else if (stack.length > 0) {\n      stack.push(token);\n    } else {\n      acc.push(token);\n    }\n\n    return acc;\n  }, []);\n\n  return tokens;\n}\n"],"mappings":";;;;;AAAA,IAAAA,oBAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,oBAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,mBAAA,GAAAH,sBAAA,CAAAC,OAAA;AAEO,SAASG,aAAaA,CAACC,MAAM,EAAE;EACpCA,MAAM,GAAG,IAAAC,4BAAmB,EAACD,MAAM,CAAC;EACpCA,MAAM,CAACE,OAAO,CAAC,UAACC,KAAK,EAAK;IACxBA,KAAK,CAACC,IAAI,GAAG,IAAAC,4BAAmB,EAACF,KAAK,CAAC;IAGvC,IAAIA,KAAK,CAACC,IAAI,KAAK,OAAO,IAAID,KAAK,CAACC,IAAI,KAAK,WAAW,EAAE;MACxDD,KAAK,CAACG,KAAK,GAAG,IAAI;IACpB;IAGA,IAAIH,KAAK,CAACC,IAAI,KAAK,OAAO,EAAE;MAC1BD,KAAK,CAACI,KAAK,CAACJ,KAAK,CAACK,SAAS,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,IAAAC,2BAAkB,EACzDN,KAAK,CAACO,QACR,CAAC;IACH;EACF,CAAC,CAAC;EAMF,IAAMC,KAAK,GAAG,EAAE;EAChBX,MAAM,GAAGA,MAAM,CAACY,MAAM,CAAC,UAACC,GAAG,EAAEV,KAAK,EAAEW,KAAK,EAAK;IAC5C,IAAIX,KAAK,CAACC,IAAI,KAAK,MAAM,IAAID,KAAK,CAACY,OAAO,KAAK,CAAC,EAAE;MAChDJ,KAAK,CAACK,IAAI,CAACb,KAAK,CAAC;IACnB,CAAC,MAAM,IACLQ,KAAK,CAACM,MAAM,GAAG,CAAC,IAChBd,KAAK,CAACC,IAAI,KAAK,MAAM,IACrBD,KAAK,CAACY,OAAO,KAAK,CAAC,CAAC,EACpB;MACA,IAAIJ,KAAK,CAACO,IAAI,CAAC,UAACC,UAAU;QAAA,OAAKA,UAAU,CAACb,KAAK;MAAA,EAAC,EAAE;QAChDK,KAAK,CAAC,CAAC,CAAC,CAACP,IAAI,GAAG,WAAW;QAC3BO,KAAK,CAAC,CAAC,CAAC,CAACL,KAAK,GAAG,IAAI;QACrBH,KAAK,CAACC,IAAI,GAAG,WAAW;QACxBD,KAAK,CAACG,KAAK,GAAG,IAAI;MACpB;MAEAK,KAAK,CAACK,IAAI,CAACb,KAAK,CAAC;MAEjB,OAAOQ,KAAK,CAACM,MAAM,EAAE;QACnBJ,GAAG,CAACG,IAAI,CAACL,KAAK,CAACS,KAAK,CAAC,CAAC,CAAC;MACzB;IACF,CAAC,MAAM,IAAIT,KAAK,CAACM,MAAM,GAAG,CAAC,EAAE;MAC3BN,KAAK,CAACK,IAAI,CAACb,KAAK,CAAC;IACnB,CAAC,MAAM;MACLU,GAAG,CAACG,IAAI,CAACb,KAAK,CAAC;IACjB;IAEA,OAAOU,GAAG;EACZ,CAAC,EAAE,EAAE,CAAC;EAEN,OAAOb,MAAM;AACf"}